{% extends "reconciliation/base.html" %}

{% block title %}Pay Periods - Reconciliation Dashboard{% endblock %}

{% block content %}
<header>
    <h1>Reconciliation Dashboards</h1>
    <p>Select a pay period to view the reconciliation dashboard</p>
</header>

<table>
    <thead>
        <tr>
            <th>Pay Period</th>
            <th>Period Start</th>
            <th>Period End</th>
            <th>Status</th>
            <th>Data Status</th>
            <th>Latest Reconciliation</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for pp in pay_periods %}
        <tr>
            <td><strong>{{ pp.period_id }}</strong></td>
            <td>{{ pp.period_start|date:"d M Y" }}</td>
            <td>{{ pp.period_end|date:"d M Y" }}</td>
            <td>
                {% if pp.status == 'completed' %}
                <span class="badge badge-success">{{ pp.status }}</span>
                {% elif pp.status == 'uploaded' %}
                <span class="badge badge-info">{{ pp.status }}</span>
                {% else %}
                <span class="badge badge-warning">{{ pp.status }}</span>
                {% endif %}
            </td>
            <td>
                {% if pp.has_tanda %}<span class="badge badge-success">Tanda</span>{% endif %}
                {% if pp.has_iqb %}<span class="badge badge-success">IQB</span>{% endif %}
                {% if pp.has_journal %}<span class="badge badge-success">Journal</span>{% endif %}
            </td>
            <td>
                {% if pp.latest_recon %}
                {{ pp.latest_recon.completed_at|date:"d M Y H:i" }}
                <br><small>{{ pp.latest_recon.status }}</small>
                {% else %}
                <span class="badge badge-warning">No reconciliation</span>
                {% endif %}
            </td>
            <td>
                {% if pp.latest_recon %}
                <a href="{% url 'reconciliation:dashboard' pp.period_id %}" class="btn">View Dashboard</a>
                {% else %}
                <span style="color: #95a5a6;">No data</span>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" style="text-align: center; padding: 40px; color: #95a5a6;">
                No pay periods found
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
